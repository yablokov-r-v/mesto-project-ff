(()=>{"use strict";function t(t,e){var o=t.target.closest(".places__item");fetch("https://mesto.nomoreparties.co/v1/wff-cohort-20/cards/".concat(e),{method:"DELETE",headers:{authorization:"df920228-ceba-4505-8d93-fdb1716d6967"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){console.log("Карточка успешно удалена ",t),o.remove()})).catch((function(t){console.log("Ошибка: ",t)}))}function e(t,e){t.target.classList.contains("card__like-button_is-active")?fetch("https://mesto.nomoreparties.co/v1/wff-cohort-20/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"df920228-ceba-4505-8d93-fdb1716d6967","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(e){console.log("Лайк успешно удален",e),t.target.classList.remove("card__like-button_is-active"),t.target.closest(".like-zone").querySelector(".card__count-like").textContent=e.likes.length})).catch((function(t){console.log("Ошибка: ",t)})):fetch("https://mesto.nomoreparties.co/v1/wff-cohort-20/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"df920228-ceba-4505-8d93-fdb1716d6967","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(e){console.log("Лайк успешно поставлен",e),t.target.classList.add("card__like-button_is-active"),t.target.closest(".like-zone").querySelector(".card__count-like").textContent=e.likes.length})).catch((function(t){console.log("Ошибка: ",t)}))}function o(t,e,o,n,r,c){var a=r.querySelector(".places__item").cloneNode(!0),i=a.querySelector(".card__title"),u=a.querySelector(".card__image"),s=a.querySelector(".card__count-like");i.textContent=t.name,u.setAttribute("src",t.link),u.setAttribute("alt",t.name),s.textContent=t.likes.length;var p=a.querySelector(".card__delete-button"),l=t._id;p.addEventListener("click",(function(t){return e(t,l)})),c!=t.owner._id&&p.remove();var d=a.querySelector(".card__like-button");return t.likes.some((function(t){return t._id===c}))&&d.classList.add("card__like-button_is-active"),d.addEventListener("click",(function(t){return n(t,l)})),u.addEventListener("click",(function(){o(t)})),a}function n(t){t.classList.remove("popup_is-opened"),t.classList.add("popup_is-animated"),document.removeEventListener("keydown",c)}function r(t){t.classList.remove("popup_is-animated"),t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function c(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}var a=function(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove("form__submit_inactive")):(e.disabled=!0,e.classList.add("form__submit_inactive"))},i=function(t){var e=t.querySelector(".popup__form"),o=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");n.disabled=!0,n.classList.add("form__submit_inactive"),o.forEach((function(t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("form__input_type_error"),o.classList.remove("form__input-error_active"),o.textContent=""}))},u=document.querySelector("#card-template").content,s=document.querySelector(".places__list"),p=document.querySelector(".profile__edit-button"),l=document.querySelector(".popup_type_edit"),d=l.querySelector(".popup__input_type_name"),_=l.querySelector(".popup__input_type_description"),f=document.querySelector(".profile__add-button"),m=document.querySelector(".popup_type_new-card"),y=l.querySelector(".popup__form"),v=y.querySelector(".popup__input_type_name"),h=y.querySelector(".popup__input_type_description"),S=m.querySelector(".popup__form"),b=S.querySelector(".popup__input_type_card-name"),q=S.querySelector(".popup__input_type_url"),g=document.querySelectorAll(".popup__close"),k=document.querySelectorAll(".popup"),L=document.querySelector(".profile__title"),C=document.querySelector(".profile__description"),E=(document.querySelector(".popup__form").querySelector(".popup__input"),document.querySelector(".profile__image")),j=document.querySelector(".popup_type_patch"),x=j.querySelector(".popup__form"),T=x.querySelector(".popup__input_type_avatar"),A=[fetch("https://mesto.nomoreparties.co/v1/wff-cohort-20/users/me",{method:"GET",headers:{authorization:"df920228-ceba-4505-8d93-fdb1716d6967","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})),fetch("https://mesto.nomoreparties.co/v1/wff-cohort-20/cards",{method:"GET",headers:{authorization:"df920228-ceba-4505-8d93-fdb1716d6967","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))}))];function w(t){var e=document.querySelector(".popup_type_image"),o=e.querySelector(".popup__image"),n=e.querySelector(".popup__caption");o.setAttribute("src",t.link),o.setAttribute("alt",t.name),n.textContent=t.name,r(e)}Promise.all(A).then((function(n){console.log(n),L.textContent=n[0].name,C.textContent=n[0].about,E.style.backgroundImage="url(".concat(n[0].avatar,")");var r=n[0]._id;n[1].forEach((function(n){var c=o(n,t,w,e,u,r);s.append(c)}))})).catch((function(t){console.log("Ошибка: ",t)})),p.addEventListener("click",(function(){d.value=L.textContent,_.value=C.textContent,i(l),r(l)})),f.addEventListener("click",(function(){r(m)})),y.addEventListener("submit",(function(t){t.preventDefault();var e=v.value,o=h.value,r=t.target.querySelector(".popup__button");r.textContent="Сохранение...",fetch("https://mesto.nomoreparties.co/v1/wff-cohort-20/users/me",{method:"PATCH",headers:{authorization:"df920228-ceba-4505-8d93-fdb1716d6967","Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){console.log("Информация в профиле успешно отредактирована ",t),L.textContent=t.name,C.textContent=t.about})).catch((function(t){console.log("Ошибка: ",t)})).finally((function(){r.textContent="Сохранить"})),n(l)})),S.addEventListener("submit",(function(r){r.preventDefault();var c=b.value,a=q.value,p=r.target.querySelector(".popup__button");p.textContent="Сохранение...",fetch("https://mesto.nomoreparties.co/v1/wff-cohort-20/cards",{method:"POST",headers:{authorization:"df920228-ceba-4505-8d93-fdb1716d6967","Content-Type":"application/json"},body:JSON.stringify({name:c,link:a})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(n){console.log("Новая карточка успешно добавлена ",n);var r=n.owner._id,c=o(n,t,w,e,u,r);s.prepend(c)})).catch((function(t){console.log("Ошибка: ",t)})).finally((function(){p.textContent="Сохранить"})),b.value="",q.value="",i(m),n(m)})),g.forEach((function(t){t.addEventListener("click",(function(){n(t.closest(".popup_is-opened"))}))})),k.forEach((function(t){t.addEventListener("click",(function(e){e.currentTarget===e.target&&n(t.closest(".popup_is-opened"))}))})),E.addEventListener("click",(function(){return r(j)})),x.addEventListener("submit",(function(t){t.preventDefault();var e=T.value,o=t.target.querySelector(".popup__button");o.textContent="Сохранение...",fetch("https://mesto.nomoreparties.co/v1/wff-cohort-20/users/me/avatar",{method:"PATCH",headers:{authorization:"df920228-ceba-4505-8d93-fdb1716d6967","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))})).then((function(t){console.log("Аватар пользователя успешно обновлен ",t),E.style.backgroundImage="url(".concat(t.avatar,")")})).catch((function(t){console.log("Ошибка: ",t)})).finally((function(){o.textContent="Сохранить"})),T.value="",i(j),n(j)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(t){!function(t){var e=Array.from(t.querySelectorAll(".popup__input")),o=t.querySelector(".popup__button");a(e,o),e.forEach((function(n){n.addEventListener("input",(function(){!function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?function(t,e){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove("form__input_type_error"),o.classList.remove("form__input-error_active"),o.textContent=""}(t,e):function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.add("form__input_type_error"),n.textContent=o,n.classList.add("form__input-error_active")}(t,e,e.validationMessage)}(t,n),a(e,o)}))}))}(t)}))})();